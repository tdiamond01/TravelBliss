@{
    ViewData["Title"] = "Calendar";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<div class="dashboard-content">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold mb-0">Calendar</h2>
        <button class="btn btn-outline-primary">
            <i class="bi bi-arrow-repeat"></i> Sync to Google Calendar/Outlook
        </button>
    </div>

    <!-- Calendar Navigation -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary" onclick="previousMonth()">
                <i class="bi bi-chevron-left"></i> Previous
            </button>
            <button class="btn btn-outline-secondary" onclick="nextMonth()">
                Next <i class="bi bi-chevron-right"></i>
            </button>
            <button class="btn btn-outline-secondary" onclick="goToToday()">Today</button>
        </div>
        <h3 class="mb-0 fw-bold" id="currentMonth">NOVEMBER 2025</h3>
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="setView('month')">Month</button>
            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="setView('week')">Week</button>
            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="setView('day')">Day</button>
        </div>
    </div>

    <!-- Calendar Grid -->
    <div class="card border-0 shadow-sm">
        <div class="card-body p-0">
            <div class="calendar-container">
                <!-- Calendar Header -->
                <div class="calendar-header">
                    <div class="calendar-day-header">SUN</div>
                    <div class="calendar-day-header">MON</div>
                    <div class="calendar-day-header">TUE</div>
                    <div class="calendar-day-header">WED</div>
                    <div class="calendar-day-header">THU</div>
                    <div class="calendar-day-header">FRI</div>
                    <div class="calendar-day-header">SAT</div>
                </div>
                <!-- Calendar Body -->
                <div class="calendar-body" id="calendarBody">
                    <!-- Calendar cells will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Chat Button -->
    <div class="chat-bubble">
        <i class="bi bi-chat-fill"></i>
        <span class="chat-text">Hi. Need any help?</span>
    </div>
</div>

<style>
.calendar-container {
    background: white;
}

.calendar-header {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
}

.calendar-day-header {
    padding: 1rem;
    text-align: center;
    font-weight: 600;
    font-size: 0.875rem;
    color: #6c757d;
}

.calendar-body {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    min-height: 600px;
}

.calendar-cell {
    border: 1px solid #dee2e6;
    min-height: 120px;
    padding: 0.5rem;
    background: white;
    position: relative;
}

.calendar-cell.other-month {
    background: #f8f9fa;
}

.calendar-cell.today {
    background: #fff8e1;
}

.calendar-cell.has-trip {
    background: #e3f2fd;
}

.calendar-date {
    font-size: 0.875rem;
    color: #6c757d;
    margin-bottom: 0.5rem;
}

.calendar-cell.other-month .calendar-date {
    color: #adb5bd;
}

.calendar-cell.today .calendar-date {
    color: #0d6efd;
    font-weight: bold;
}

.calendar-event {
    background: #0d6efd;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    margin-bottom: 0.25rem;
    cursor: pointer;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.calendar-event:hover {
    background: #0b5ed7;
}

/* Mobile responsive styles */
@@media (max-width: 768px) {
    .d-flex.justify-content-between.align-items-center.mb-4 {
        flex-direction: column;
        align-items: stretch !important;
        gap: 15px;
    }

    .d-flex.gap-2 button {
        font-size: 0.875rem;
        padding: 0.5rem;
    }

    .btn-outline-primary {
        font-size: 0.875rem;
    }

    h3#currentMonth {
        font-size: 1.25rem;
    }

    .btn-group {
        width: 100%;
    }

    .btn-group .btn-sm {
        flex: 1;
        font-size: 0.75rem;
    }

    .calendar-cell {
        min-height: 80px;
        padding: 0.25rem;
    }

    .calendar-day-header {
        padding: 0.5rem;
        font-size: 0.75rem;
    }

    .calendar-date {
        font-size: 0.75rem;
    }

    .calendar-event {
        font-size: 0.65rem;
        padding: 0.125rem 0.25rem;
    }

    .card {
        border-radius: 0.5rem;
    }
}

@@media (max-width: 480px) {
    .calendar-cell {
        min-height: 60px;
    }

    .calendar-day-header {
        padding: 0.25rem;
        font-size: 0.65rem;
    }

    .calendar-date {
        font-size: 0.65rem;
        margin-bottom: 0.25rem;
    }

    .calendar-event {
        font-size: 0.6rem;
        padding: 0.1rem 0.2rem;
    }

    h3#currentMonth {
        font-size: 1rem;
    }
}
</style>

<script>
// Sample trip data
const trips = [
    {
        id: 1,
        name: "Travis Diamond's TEST Group",
        startDate: new Date(2025, 10, 9), // November 9, 2025
        endDate: new Date(2025, 10, 9),
        client: "Travis Diamond"
    },
    {
        id: 2,
        name: "Travis Diamond's TEST Trip",
        startDate: new Date(2025, 10, 8), // November 8, 2025
        endDate: new Date(2025, 10, 8),
        client: "Travis Diamond"
    }
];

let currentDate = new Date();
let currentView = 'month';

function renderCalendar() {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    // Update header
    const monthNames = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE",
                       "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];
    document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;

    // Get first day of month and number of days
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const daysInPrevMonth = new Date(year, month, 0).getDate();

    const calendarBody = document.getElementById('calendarBody');
    calendarBody.innerHTML = '';

    let dayCount = 1;
    let nextMonthDay = 1;

    // Calculate total cells needed (6 rows x 7 days)
    const totalCells = 42;

    for (let i = 0; i < totalCells; i++) {
        const cell = document.createElement('div');
        cell.className = 'calendar-cell';

        let cellDate;
        let dateNum;

        if (i < firstDay) {
            // Previous month days
            dateNum = daysInPrevMonth - firstDay + i + 1;
            cell.classList.add('other-month');
            cellDate = new Date(year, month - 1, dateNum);
        } else if (dayCount <= daysInMonth) {
            // Current month days
            dateNum = dayCount;
            cellDate = new Date(year, month, dateNum);

            // Check if today
            const today = new Date();
            if (cellDate.toDateString() === today.toDateString()) {
                cell.classList.add('today');
            }

            dayCount++;
        } else {
            // Next month days
            dateNum = nextMonthDay;
            cell.classList.add('other-month');
            cellDate = new Date(year, month + 1, dateNum);
            nextMonthDay++;
        }

        // Add date number
        const dateDiv = document.createElement('div');
        dateDiv.className = 'calendar-date';
        dateDiv.textContent = dateNum;
        cell.appendChild(dateDiv);

        // Check for trips on this date
        const tripsOnDate = trips.filter(trip => {
            const tripStart = new Date(trip.startDate);
            const tripEnd = new Date(trip.endDate);
            tripStart.setHours(0, 0, 0, 0);
            tripEnd.setHours(23, 59, 59, 999);
            cellDate.setHours(0, 0, 0, 0);
            return cellDate >= tripStart && cellDate <= tripEnd;
        });

        if (tripsOnDate.length > 0) {
            cell.classList.add('has-trip');
            tripsOnDate.forEach(trip => {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'calendar-event';
                eventDiv.textContent = trip.name;
                eventDiv.title = trip.name;
                eventDiv.onclick = () => showTripDetails(trip);
                cell.appendChild(eventDiv);
            });
        }

        calendarBody.appendChild(cell);
    }
}

function previousMonth() {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
}

function nextMonth() {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
}

function goToToday() {
    currentDate = new Date();
    renderCalendar();
}

function setView(view) {
    currentView = view;
    // Remove active class from all buttons
    document.querySelectorAll('.btn-group .btn').forEach(btn => {
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-outline-secondary');
    });
    // Add active class to clicked button
    event.target.classList.remove('btn-outline-secondary');
    event.target.classList.add('btn-primary');

    // For now, only month view is implemented
    if (view !== 'month') {
        alert('Week and Day views coming soon!');
    }
}

function showTripDetails(trip) {
    // Navigate to the group details page
    window.location.href = '/Groups/Details/' + trip.id;
}

// Initialize calendar on page load
document.addEventListener('DOMContentLoaded', function() {
    renderCalendar();
    // Set month view as default active
    document.querySelector('.btn-group .btn:first-child').classList.remove('btn-outline-secondary');
    document.querySelector('.btn-group .btn:first-child').classList.add('btn-primary');
});
</script>
